
-- Import Utility Scripts
import("cardinal.scar")							-- Contains sfx references, UI templates, and Civ/Age helper functions
import("ScarUtil.scar")							-- Contains game helper functions

-- Import Gameplay Systems
import("gameplay/score.scar")					-- Tracks player score
import("gameplay/diplomacy.scar")				-- Manages Tribute

-- preserve all standard ways to win
import("winconditions/annihilation.scar")   -- military conquest by eliminating all enemies
import("winconditions/elimination.scar")    -- handles player drops/disconnect
import("winconditions/surrender.scar")      -- surrender via UI



-- Import UI Support
import("gameplay/chi/current_dynasty_ui.scar")	-- Displays Chinese Dynasty UI
import("gameplay/event_cues.scar")
import("gameplay/currentageui.scar")


-- import("modifiers.scar")
-- Import cheat support
import("gameplay/cheat.scar") 

Core_RegisterModule("RND")


listOfAllWeapons = { "animal_attack_dangerous", "animal_attack_dangerous_charge", "animal_attack_huntable", "animal_attack_huntable_charge", "hover_sheep_rogue", "weapon_abbey_king_axe_eng", "weapon_abbey_king_charge_eng", "weapon_acre_barrage_dot_abb", "weapon_archer_2", "weapon_archer_2_byz_ha_mac", "weapon_archer_2_eng", "weapon_archer_2_hre_ha_01", "weapon_archer_2_improved_abb", "weapon_archer_2_incendiary_improved_abb", "weapon_archer_2_jeanne_fre_ha_01", "weapon_archer_2_jpn", "weapon_archer_2_melee", "weapon_archer_2_melee_rus", "weapon_archer_2_mon", "weapon_archer_2_nrm", "weapon_archer_2_rus", "weapon_archer_3", "weapon_archer_3_byz_ha_mac", "weapon_archer_3_eng", "weapon_archer_3_hre_ha_01", "weapon_archer_3_improved_abb", "weapon_archer_3_incendiary_improved_abb", "weapon_archer_3_jpn", "weapon_archer_3_melee", "weapon_archer_3_melee_nov", "weapon_archer_3_melee_rus", "weapon_archer_3_mon", "weapon_archer_3_nov", "weapon_archer_3_nrm", "weapon_archer_3_rus", "weapon_archer_4", "weapon_archer_4_byz_ha_mac", "weapon_archer_4_eng", "weapon_archer_4_hre_ha_01", "weapon_archer_4_improved_abb", "weapon_archer_4_incendiary_improved_abb", "weapon_archer_4_jeanne_fre_ha_01", "weapon_archer_4_jpn", "weapon_archer_4_melee", "weapon_archer_4_melee_rus", "weapon_archer_4_mon", "weapon_archer_4_nrm", "weapon_archer_4_ranged_jeanne_projectile_arrow_fre_ha_01", "weapon_archer_4_rus", "weapon_archer_incendiary", "weapon_archer_incendiary__building_fire_improved_abb", "weapon_archer_incendiary_2_byz_ha_mac", "weapon_archer_incendiary_2_jeanne_fre_ha_01", "weapon_archer_incendiary_2_jpn", "weapon_archer_incendiary_3", "weapon_archer_incendiary_3_byz_ha_mac", "weapon_archer_incendiary_3_hre_ha_01", "weapon_archer_incendiary_3_jpn", "weapon_archer_incendiary_4", "weapon_archer_incendiary_4_byz_ha_mac", "weapon_archer_incendiary_4_hre_ha_01", "weapon_archer_incendiary_4_jeanne_fre_ha_01", "weapon_archer_incendiary_4_jpn", "weapon_archer_incendiary_building_fire", "weapon_archer_incendiary_building_fire_byz_ha_mac", "weapon_archer_incendiary_building_fire_hre_ha_01", "weapon_archer_incendiary_building_fire_jpn", "weapon_archer_incendiary_camp_2_eng", "weapon_archer_incendiary_camp_2_nrm", "weapon_archer_incendiary_camp_3_eng", "weapon_archer_incendiary_camp_3_nrm", "weapon_archer_incendiary_camp_4_eng", "weapon_archer_incendiary_camp_4_nrm", "weapon_archer_incendiary_camp_eng", "weapon_archer_incendiary_camp_nrm", "weapon_archer_incendiary_hre_ha_01", "weapon_archer_incendiary_mon", "weapon_archer_incendiary_no_burn_mon", "weapon_archer_incendiary_rus", "weapon_archer_poisoned_2_mal", "weapon_archer_poisoned_3_mal", "weapon_archer_poisoned_4_mal", "weapon_archer_ram_tower_abb_ha_1", "weapon_archer_ram_tower_incendiary_abb_ha_1", "weapon_archer_rogue", "weapon_archer_rogue_incendiary", "weapon_archer_spear_4_eng", "weapon_archer_spear_4_nrm", "weapon_baldwin_cmp_tem", "weapon_bandit_axe", "weapon_bandit_horseman", "weapon_bandit_sword", "weapon_bandit_sword_charge", "weapon_banner_cavalry_2_charge_jpn", "weapon_banner_cavalry_2_jpn", "weapon_banner_cavalry_3_charge_jpn", "weapon_banner_cavalry_3_jpn", "weapon_banner_cavalry_4_charge_jpn", "weapon_banner_cavalry_4_jpn", "weapon_banner_ranged_2_jpn", "weapon_banner_ranged_3_jpn", "weapon_banner_ranged_4_jpn", "weapon_banner_ranged_incendiary_2_jpn", "weapon_banner_ranged_incendiary_3_jpn", "weapon_banner_ranged_incendiary_4_jpn", "weapon_banner_ranged_incendiary_building_fire_jpn", "weapon_banner_samurai_2_charge_jpn", "weapon_banner_samurai_2_jpn", "weapon_banner_samurai_3_charge_jpn", "weapon_banner_samurai_3_jpn", "weapon_banner_samurai_4_charge_jpn", "weapon_banner_samurai_4_jpn", "weapon_barbican_handcannon_chi", "weapon_barrage_initial_explosive", "weapon_berserker_charge_rogue", "weapon_berserker_rogue", "weapon_bill_1_base_lan", "weapon_bill_1_brace_lan", "weapon_bill_1_charge_lan", "weapon_bill_2_base_lan", "weapon_bill_2_brace_lan", "weapon_bill_2_charge_lan", "weapon_bill_3_base_lan", "weapon_bill_3_brace_lan", "weapon_bill_3_charge_lan", "weapon_bill_4_base_lan", "weapon_bill_4_brace_lan", "weapon_bill_4_charge_lan", "weapon_black_rider_4", "weapon_black_rider_4_caracole", "weapon_bodyguard_2_charge_mon_ha_hol", "weapon_bodyguard_2_mon_ha_gol", "weapon_bodyguard_3_charge_mon_ha_gol", "weapon_bodyguard_3_mon_ha_gol", "weapon_bodyguard_4_charge_mon_ha_gol", "weapon_bodyguard_4_mon_ha_gol", "weapon_bombard_3", "weapon_bombard_4", "weapon_bombard_4_improved_eng", "weapon_bombard_4_improved_nrm", "weapon_bombard_4_larger_aoe_chi", "weapon_bombard_4_mon", "weapon_bombard_4_rus", "weapon_bombard_4_rus_tech", "weapon_bombard_larger_aoe_chi_ha_01", "weapon_bow_samurai_1_jpn_ha_sen", "weapon_bow_samurai_2_jpn_ha_sen", "weapon_bow_samurai_3_jpn_ha_sen", "weapon_bow_samurai_incendiary_1_jpn_ha_sen", "weapon_bow_samurai_incendiary_2_jpn_ha_sen", "weapon_bow_samurai_incendiary_3_jpn_ha_sen", "weapon_breachhead_arrows_mon_ha_gol", "weapon_cambulance_ranged_2_abb_ha_01", "weapon_camel_archer_2_abb", "weapon_camel_archer_2_improved_abb", "weapon_camel_archer_3_improved_abb", "weapon_camel_archer_4_abb", "weapon_camel_archer_incendiary", "weapon_camel_archer_incendiary_3", "weapon_camel_archer_incendiary_4", "weapon_camel_archer_incendiary_building_fire_abb", "weapon_camel_archer_melee_abb", "weapon_cannon_4", "weapon_cannon_4_form_fre", "weapon_cannon_4_improved_eng", "weapon_cannon_4_improved_nrm", "weapon_cannon_4_larger_aoe_chi", "weapon_cannon_4_royal_fre", "weapon_cannon_4_rus", "weapon_cannon_barrage_royal_fre", "weapon_cannon_rogue", "weapon_castle_lancaster_arrow_lan", "weapon_champion_3_charge_lan", "weapon_champion_3_lan", "weapon_champion_4_charge_lan", "weapon_champion_4_lan", "weapon_champion_sword_charge", "weapon_champion_throw_3_lan", "weapon_champion_throw_4_lan", "weapon_chevalier_confrere_2_charge_tem", "weapon_chevalier_confrere_2_tem", "weapon_chevalier_confrere_3_charge_tem", "weapon_chevalier_confrere_3_tem", "weapon_chevalier_confrere_4_charge_tem", "weapon_chevalier_confrere_4_tem", "weapon_condo_4_charge_tem", "weapon_condo_4_tem", "weapon_crossbow_3", "weapon_crossbow_3_fre", "weapon_crossbow_3_hre_ha_01", "weapon_crossbow_3_library_upgrade_chi_ha_01", "weapon_crossbow_3_library_upgrade_incendiary_chi_ha_01", "weapon_crossbow_3_melee", "weapon_crossbow_3_melee_nov", "weapon_crossbow_3_melee_rus", "weapon_crossbow_3_mon", "weapon_crossbow_3_nov", "weapon_crossbow_3_rus", "weapon_crossbow_3_siege_damage_hre_ha_01", "weapon_crossbow_4", "weapon_crossbow_4_fre", "weapon_crossbow_4_lib_incendiary_building_fire_chi_ha_01", "weapon_crossbow_4_library_upgrade_chi_ha_01", "weapon_crossbow_4_library_upgrade_incendiary_chi_ha_01", "weapon_crossbow_4_melee", "weapon_crossbow_4_melee_rus", "weapon_crossbow_4_mon", "weapon_crossbow_4_rus", "weapon_crossbow_4_siege_damage_hre_ha_01", "weapon_crossbow_incendiary", "weapon_crossbow_incendiary_4", "weapon_crossbow_incendiary_4_hre_ha_01", "weapon_crossbow_incendiary_4_mon", "weapon_crossbow_incendiary_4_siege_damage_hre_ha_01", "weapon_crossbow_incendiary_building_fire", "weapon_crossbow_incendiary_building_fire_hre_ha_01", "weapon_crossbow_incendiary_hre_ha_01", "weapon_crossbow_incendiary_mon", "weapon_crossbow_incendiary_rus", "weapon_crossbow_incendiary_siege_damage_hre_ha_01", "weapon_crossbow_incendiary_sul", "weapon_crossbow_rogue", "weapon_crossbow_rogue_incendiary", "weapon_culverin_4", "weapon_culverin_4_form_fre", "weapon_culverin_4_improved_eng", "weapon_culverin_4_improved_nrm", "weapon_culverin_4_larger_aoe_chi", "weapon_culverin_4_royal_fre", "weapon_culverin_4_rus", "weapon_daimyo_2_charge_jpn_ha_sen", "weapon_daimyo_2_jpn_ha_sen", "weapon_daimyo_3_charge_jpn_ha_sen", "weapon_daimyo_3_jpn_ha_sen", "weapon_daimyo_4_charge_jpn_ha_sen", "weapon_daimyo_4_jpn_ha_sen", "weapon_dock_arrows", "weapon_dock_springald_tem", "weapon_dragonite_archer_hre_boss_rogue", "weapon_dromon_flame_thrower_byz", "weapon_dummy", "weapon_dummy_elephant_worker", "weapon_dummy_horse_hack", "weapon_dummy_horse_melee_hack", "weapon_dummy_horse_ranged_hack", "weapon_dummy_melee_elephant_worker", "weapon_dummy_warship", "weapon_ea_crossbow_incendiary_building_fire_sul", "weapon_ea_incendiary_building_fire_sul", "weapon_earlsguard_francisca_throw_3_lan", "weapon_earlsguard_francisca_throw_4_lan", "weapon_elephant_archer_crossbow_incendiary_sul", "weapon_elephant_archer_incendiary_sul", "weapon_firelancer_2_charge_chi_ha_01", "weapon_firelancer_2_chi_ha_01", "weapon_firelancer_3_charge_chi", "weapon_firelancer_3_chi", "weapon_firelancer_4_charge_chi", "weapon_firelancer_4_chi", "weapon_freebornwarrior_3_charge_mal", "weapon_freebornwarrior_3_mal", "weapon_freebornwarrior_4_charge_mal", "weapon_freebornwarrior_4_mal", "weapon_genitour_3_tem", "weapon_genitour_4_tem", "weapon_genitour_incen_3_tem", "weapon_genitour_incen_4_tem", "weapon_genitour_incen_building_fire_tem", "weapon_genoese_crossbow", "weapon_genoese_crossbow_3_tem", "weapon_genoese_crossbow_4_tem", "weapon_genoese_crossbow_byz_ha_mac", "weapon_genoese_crossbow_incendiary_3_tem", "weapon_genoese_crossbow_incendiary_4_tem", "weapon_genoese_crossbow_incendiary_building_fire_tem", "weapon_great_bombard_3_ott", "weapon_great_bombard_4_ott", "weapon_great_bombard_emplacement_ott", "weapon_great_wall_bees_chi", "weapon_grenade_2", "weapon_grenade_3", "weapon_grenade_3_chi_ha", "weapon_grenade_4", "weapon_grenade_improved_3_chi_ha", "weapon_grenade_improved_4_chi_ha_01", "weapon_grenade_siege_chi", "weapon_grenadier_2_melee_chi", "weapon_grenadier_hero_rogue", "weapon_hand_axe_ayy", "weapon_handcannon_3", "weapon_handcannon_3_jpn_ha_sen", "weapon_handcannon_3_lan_college", "weapon_handcannon_3_leadshot_jpn_ha_sen", "weapon_handcannon_3_melee", "weapon_handcannon_3_ott", "weapon_handcannon_4", "weapon_handcannon_4_hre_ha_1", "weapon_handcannon_4_jpn_ha_sen", "weapon_handcannon_4_leadshot", "weapon_handcannon_4_leadshot_hre_ha_1", "weapon_handcannon_4_leadshot_jpn_ha_sen", "weapon_handcannon_4_leadshot_rus", "weapon_handcannon_4_mal", "weapon_handcannon_4_melee", "weapon_handcannon_4_melee_jeanne_fre_ha_01", "weapon_handcannon_4_melee_rus", "weapon_handcannon_4_mon", "weapon_handcannon_4_ott", "weapon_handcannon_4_ranged_jeanne_fre_ha_01", "weapon_handcannon_4_ranged_jeanne_projectile_cannon_fre_ha_01", "weapon_handcannon_4_rus", "weapon_handcannon_leadshot_mal", "weapon_handcannon_nobunaga_rogue", "weapon_heavy_spearman_3_brace_tem", "weapon_heavy_spearman_3_charge_tem", "weapon_heavy_spearman_3_tem", "weapon_heavy_spearman_4_brace_tem", "weapon_heavy_spearman_4_charge_tem", "weapon_heavy_spearman_4_tem", "weapon_hobelar_2_charge_lan", "weapon_hobelar_2_lan", "weapon_hobelar_3_charge_lan", "weapon_hobelar_3_lan", "weapon_hobelar_4_charge_lan", "weapon_hobelar_4_lan", "weapon_holy_order_hospitaller_charge_cru", "weapon_holy_order_hospitaller_cru", "weapon_holy_order_hospitaller_master_charge_cru", "weapon_holy_order_hospitaller_master_cru", "weapon_holy_order_templar_charge_cru", "weapon_holy_order_templar_cru", "weapon_holy_order_templar_master_charge_cru", "weapon_holy_order_templar_master_cru", "weapon_holy_order_teuton_charge_cru", "weapon_holy_order_teuton_cru", "weapon_holy_order_teuton_master_charge_cru", "weapon_holy_order_teuton_master_cru", "weapon_horse_archer_improved_incendiary_mon", "weapon_horsearcher_2", "weapon_horsearcher_2_mon", "weapon_horsearcher_2_ott", "weapon_horsearcher_3", "weapon_horsearcher_3_jpn", "weapon_horsearcher_3_mon", "weapon_horsearcher_3_nov", "weapon_horsearcher_3_ott", "weapon_horsearcher_3_rus", "weapon_horsearcher_4", "weapon_horsearcher_4_jpn", "weapon_horsearcher_4_mon", "weapon_horsearcher_4_ott", "weapon_horsearcher_4_rus", "weapon_horsearcher_incendiary_2_ott", "weapon_horsearcher_incendiary_3_jpn", "weapon_horsearcher_incendiary_3_mon", "weapon_horsearcher_incendiary_3_ott", "weapon_horsearcher_incendiary_4_jpn", "weapon_horsearcher_incendiary_4_mon", "weapon_horsearcher_incendiary_4_ott", "weapon_horsearcher_incendiary_4_rus", "weapon_horsearcher_incendiary_building_fire_jpn", "weapon_horsearcher_incendiary_building_fire_mon", "weapon_horsearcher_incendiary_building_fire_ott", "weapon_horsearcher_incendiary_building_fire_rus", "weapon_horsearcher_incendiary_building_fire_triple_mon_ha_gol", "weapon_horsearcher_incendiary_mon", "weapon_horsearcher_incendiary_rus", "weapon_horsearcher_incendiary_triple_2_mon_ha_gol", "weapon_horsearcher_incendiary_triple_3_mon_ha_gol", "weapon_horsearcher_incendiary_triple_3_range_1_mon_ha_gol", "weapon_horsearcher_incendiary_triple_3_range_2_mon_ha_gol", "weapon_horsearcher_incendiary_triple_3_range_3_mon_ha_gol", "weapon_horsearcher_incendiary_triple_4_mon_ha_gol", "weapon_horsearcher_incendiary_triple_4_range_1_mon_ha_gol", "weapon_horsearcher_incendiary_triple_4_range_2_mon_ha_gol", "weapon_horsearcher_incendiary_triple_4_range_3_mon_ha_gol", "weapon_horsearcher_melee_mon", "weapon_horsearcher_melee_rus", "weapon_horsearcher_rogue", "weapon_horsearcher_triple_2_b_mon_ha_gol", "weapon_horsearcher_triple_2_mon_ha_gol", "weapon_horsearcher_triple_3_mon_ha_gol", "weapon_horsearcher_triple_3_dummy_mon_ha_gol", "weapon_horsearcher_triple_3_range_1_mon_ha_gol", "weapon_horsearcher_triple_3_range_2_mon_ha_gol", "weapon_horsearcher_triple_3_range_3_mon_ha_gol", "weapon_horsearcher_triple_4_dummy_mon_ha_gol", "weapon_horsearcher_triple_4_mon_ha_gol", "weapon_horsearcher_triple_4_range_1_mon_ha_gol", "weapon_horsearcher_triple_4_range_2_mon_ha_gol", "weapon_horsearcher_triple_4_range_3_mon_ha_gol", "weapon_horseman_1", "weapon_horseman_1_charge", "weapon_horseman_1_charge_hre_ha_01", "weapon_horseman_1_hre_ha_01", "weapon_horseman_1_mon", "weapon_horseman_2", "weapon_horseman_2_charge", "weapon_horseman_2_charge_fire_chi_ha_01", "weapon_horseman_2_charge_hre_ha_01", "weapon_horseman_2_charge_jpn_ha_sen", "weapon_horseman_2_charge_mal", "weapon_horseman_2_charge_ott", "weapon_horseman_2_charge_rus", "weapon_horseman_2_charge_sul", "weapon_horseman_2_charge_tem", "weapon_horseman_2_hippodrome_byz", "weapon_horseman_2_hippodrome_charge_byz", "weapon_horseman_2_hre_ha_01", "weapon_horseman_2_jpn_ha_sen", "weapon_horseman_2_mal", "weapon_horseman_2_mon", "weapon_horseman_2_ott", "weapon_horseman_2_rus", "weapon_horseman_2_sul", "weapon_horseman_3", "weapon_horseman_3_charge", "weapon_horseman_3_charge_fire_chi_ha_01", "weapon_horseman_3_charge_hre_ha_01", "weapon_horseman_3_charge_jpn_ha_sen", "weapon_horseman_3_charge_mal", "weapon_horseman_3_charge_nov", "weapon_horseman_3_charge_ott", "weapon_horseman_3_charge_rus", "weapon_horseman_3_charge_sul", "weapon_horseman_3_charge_tem", "weapon_horseman_3_hippodrome_byz", "weapon_horseman_3_hippodrome_charge_byz", "weapon_horseman_3_hre_ha_01", "weapon_horseman_3_jpn_ha_sen", "weapon_horseman_3_mal", "weapon_horseman_3_mon", "weapon_horseman_3_nov", "weapon_horseman_3_ott", "weapon_horseman_3_rus", "weapon_horseman_3_sul", "weapon_horseman_4", "weapon_horseman_4_charge", "weapon_horseman_4_charge_fire_chi_ha_01", "weapon_horseman_4_charge_hre_ha_01", "weapon_horseman_4_charge_jpn_ha_sen", "weapon_horseman_4_charge_mal", "weapon_horseman_4_charge_ott", "weapon_horseman_4_charge_rus", "weapon_horseman_4_charge_sul", "weapon_horseman_4_charge_tem", "weapon_horseman_4_hippodrome_byz", "weapon_horseman_4_hippodrome_charge_byz", "weapon_horseman_4_hre_ha_01", "weapon_horseman_4_jpn_ha_sen", "weapon_horseman_4_mal", "weapon_horseman_4_mon", "weapon_horseman_4_ott", "weapon_horseman_4_rus", "weapon_horseman_4_sul", "weapon_horseman_charge_no_damage", "weapon_horseman_improved_2_charge_jpn_ha_sen", "weapon_horseman_improved_2_jpn_ha_sen", "weapon_horseman_improved_3_charge_jpn_ha_sen", "weapon_horseman_improved_3_jpn_ha_sen", "weapon_horseman_improved_4_charge_jpn_ha_sen", "weapon_horseman_improved_4_jpn_ha_sen", "weapon_hospitaller_2_charge_tem", "weapon_hospitaller_2_tem", "weapon_hospitaller_3_charge_tem", "weapon_hospitaller_3_tem", "weapon_hospitaller_4_charge_tem", "weapon_hospitaller_4_tem", "weapon_huihui_pao", "weapon_huihui_pao_rogue", "weapon_ikko_monk_3_charge_jpn_ha_sen", "weapon_ikko_monk_3_jpn_ha_sen", "weapon_javelin_1", "weapon_javelin_1_donso", "weapon_javelin_2", "weapon_javelin_2_abb_ha_01", "weapon_javelin_2_melee", "weapon_javelin_3", "weapon_javelin_3_melee", "weapon_javelin_4", "weapon_javelin_4_melee", "weapon_javelin_donso_2_mal", "weapon_javelin_donso_3_mal", "weapon_javelin_donso_4_mal", "weapon_jeanne_follower_3", "weapon_jeanne_follower_4", "weapon_jeanne_follower_charge_3", "weapon_jeanne_follower_charge_4", "weapon_jeanne_rider_3", "weapon_jeanne_rider_4", "weapon_jeanne_rider_charge_3", "weapon_jeanne_rider_charge_4", "weapon_kanabo_2_2handmace_charge_jpn_ha_sen", "weapon_kanabo_2_2handmace_jpn_ha_sen", "weapon_kanabo_3_2handmace_charge_jpn_ha_sen", "weapon_kanabo_3_2handmace_jpn_ha_sen", "weapon_kanabo_4_2handmace_charge_jpn_ha_sen", "weapon_kanabo_4_2handmace_jpn_ha_sen", "weapon_keep_arbalest_a", "weapon_keep_arbalest_b", "weapon_keep_arbalest_c", "weapon_keep_arbalest_d", "weapon_keep_arrows_a", "weapon_keep_arrows_a_poison_mal", "weapon_keep_arrows_b", "weapon_keep_arrows_b_poison_mal", "weapon_keep_arrows_c", "weapon_keep_arrows_c_poison_mal", "weapon_keep_arrows_garrison", "weapon_keep_arrows_garrison_incen", "weapon_keep_arrows_garrison_poison_mal", "weapon_keep_arrows_incen_a", "weapon_keep_arrows_incen_b", "weapon_keep_arrows_incen_c", "weapon_keep_bolts_garrison_ott", "weapon_keep_cannon", "weapon_keep_cannon_berkshire", "weapon_keep_crossbow_a", "weapon_keep_handcannon_chi", "weapon_keep_handcannon_garrison_chi", "weapon_keep_mangonel", "weapon_keep_murder_hole", "weapon_keep_rocket_jpn", "weapon_keep_springald", "weapon_keep_springald_1_berkshire", "weapon_keep_springald_rus", "weapon_keep_trebuchet", "weapon_khaganate_huihui_pao", "weapon_khagnate_huihui_pao_merc_byz", "weapon_khagnate_knight_rus_mon", "weapon_khan_1_mon", "weapon_khan_2_charge_mon_ha_gol", "weapon_khan_2_mon", "weapon_khan_2_mon_ha_gol", "weapon_khan_3_charge_mon_ha_gol", "weapon_khan_3_mon", "weapon_khan_3_mon_ha_gol", "weapon_khan_4_charge_mon_ha_gol", "weapon_khan_4_mon", "weapon_khan_4_mon_ha_gol", "weapon_khan_debuff_2_mon_ha_gol", "weapon_khan_hunter_deer_2_mon", "weapon_khan_hunter_deer_3_mon", "weapon_khan_hunter_deer_4_mon", "weapon_khan_hunter_deer_incen_2_mon", "weapon_khan_hunter_deer_incen_3_mon", "weapon_khan_hunter_deer_incen_4_mon", "weapon_khan_hunter_deer_incen_building_fire_mon", "weapon_khan_incen_4_mon", "weapon_khan_incen_building_4_mon", "weapon_kharash_2_charge_mon_ha_gol", "weapon_kharash_2_mon_ha_gol", "weapon_king_ivan_1handsword_charge", "weapon_king_ivan_charge", "weapon_king_ivan_rus", "weapon_kipchak_3_mon_ha_gol", "weapon_kipchak_4_mon_ha_gol", "weapon_kipchak_incendiary_3_mon_ha_gol", "weapon_kipchak_incendiary_4_mon_ha_gol", "weapon_kipchak_incendiary_building_fire_mon_ha_gol", "weapon_kitbuqa_cmp_mon", "weapon_knight_2", "weapon_knight_2_axe_rus", "weapon_knight_2_charge", "weapon_knight_2_charge_fre", "weapon_knight_2_charge_rus", "weapon_knight_2_rus", "weapon_knight_3", "weapon_knight_3_abb_ha_01", "weapon_knight_3_axe_rus", "weapon_knight_3_byz", "weapon_knight_3_byz_ha_mac", "weapon_knight_3_charge", "weapon_knight_3_charge_abb_ha_01", "weapon_knight_3_charge_byz", "weapon_knight_3_charge_byz_ha_mac", "weapon_knight_3_charge_chi", "weapon_knight_3_charge_collarofesses_lan", "weapon_knight_3_charge_fre", "weapon_knight_3_charge_hippodrome_byz", "weapon_knight_3_charge_hippodrome_byz_ha_mac", "weapon_knight_3_charge_hippodrome_rhomphaia_byz_ha_mac", "weapon_knight_3_charge_hre_ha_01", "weapon_knight_3_charge_improved_sul", "weapon_knight_3_charge_jeanne_fre_ha_01", "weapon_knight_3_charge_nov", "weapon_knight_3_charge_rhomphaia_byz_ha_mac", "weapon_knight_3_charge_rus", "weapon_knight_3_chi", "weapon_knight_3_collarofesses_lan", "weapon_knight_3_hre_ha_01", "weapon_knight_3_improved_ott", "weapon_knight_3_improved_sul", "weapon_knight_3_jeanne_fre_ha_01", "weapon_knight_3_nov", "weapon_knight_3_ott", "weapon_knight_3_rhomphaia_byz_ha_mac", "weapon_knight_3_rus", "weapon_knight_4", "weapon_knight_4_abb_ha_01", "weapon_knight_4_axe_rus", "weapon_knight_4_byz", "weapon_knight_4_byz_ha_mac", "weapon_knight_4_charge", "weapon_knight_4_charge_abb_ha_01", "weapon_knight_4_charge_byz", "weapon_knight_4_charge_byz_ha_mac", "weapon_knight_4_charge_chi", "weapon_knight_4_charge_collarofesses_lan", "weapon_knight_4_charge_fre", "weapon_knight_4_charge_hippodrome_byz", "weapon_knight_4_charge_hippodrome_byz_ha_mac", "weapon_knight_4_charge_hippodrome_rhomphaia_byz_ha_mac", "weapon_knight_4_charge_hre_ha_01", "weapon_knight_4_charge_improved_sul", "weapon_knight_4_charge_rhomphaia_byz_ha_mac", "weapon_knight_4_charge_rus", "weapon_knight_4_chi", "weapon_knight_4_collarofesses_lan", "weapon_knight_4_hre_ha_01", "weapon_knight_4_improved_ott", "weapon_knight_4_improved_sul", "weapon_knight_4_ott", "weapon_knight_4_rhomphaia_byz_ha_mac", "weapon_knight_4_rus", "weapon_knight_rogue", "weapon_knight_rogue_charge", "weapon_knight_templar_3_charge_tem", "weapon_knight_templar_3_tem", "weapon_knight_templar_4_charge_tem", "weapon_knight_templar_4_tem", "weapon_knight_william", "weapon_kremlin_arrows", "weapon_kremlin_arrows_garrison", "weapon_lancaster_manor_arrow", "weapon_lancer_2_charge_mon", "weapon_lancer_2_mon", "weapon_lancer_3_charge_cmp_mon", "weapon_lancer_3_charge_fire_chi_ha_01", "weapon_lancer_3_charge_mon", "weapon_lancer_3_cmp_mon", "weapon_lancer_3_mon", "weapon_lancer_4_charge_fire_chi_ha_01", "weapon_lancer_4_charge_mon", "weapon_lancer_4_mon", "weapon_landmark_ozutsu_jpn", "weapon_landshark_charge_hre_boss_rogue", "weapon_landshark_hre_boss_rogue", "weapon_landshark_spec_hre_boss_rogue", "weapon_landsknecht_3_charge_halberd_hre_ha_01", "weapon_landsknecht_3_charge_hre", "weapon_landsknecht_3_charge_hre_ha_01", "weapon_landsknecht_3_halberd_hre_ha_01", "weapon_landsknecht_3_hre", "weapon_landsknecht_3_hre_ha_01", "weapon_landsknecht_4_charge_halberd_hre_ha_01", "weapon_landsknecht_4_charge_hre", "weapon_landsknecht_4_charge_hre_ha_01", "weapon_landsknecht_4_halberd_hre_ha_01", "weapon_landsknecht_4_hre", "weapon_landsknecht_4_hre_ha_01", "weapon_leader_baibars_ayy", "weapon_leader_commander_ayy", "weapon_leader_commander_charge_ayy", "weapon_leader_saladin_knight_ayy", "weapon_leader_saladin_knight_charge_ayy", "weapon_leader_saladin_maa_ayy", "weapon_leader_saladin_maa_charge_ayy", "weapon_leader_shirkuh_ayy", "weapon_leader_shirkuh_charge_ayy", "weapon_leader_tughtekin_ayy", "weapon_longbowman_incendiary", "weapon_longbowman_incendiary_3", "weapon_longbowman_incendiary_4", "weapon_longbowman_incendiary_building_fire_eng", "weapon_mameluke_sword_3", "weapon_mameluke_sword_3_charge", "weapon_mameluke_sword_4", "weapon_mameluke_sword_4_charge", "weapon_mamluk_melee_2_abb_ha_01", "weapon_mamluk_melee_3_abb_ha_01", "weapon_mamluk_melee_4_abb_ha_01", "weapon_mamluk_ranged_2_abb_ha_01", "weapon_mamluk_ranged_2_incendiary_abb_ha_01", "weapon_mamluk_ranged_3_incendiary_abb_ha_01", "weapon_mamluk_ranged_3_abb_ha_01", "weapon_mamluk_ranged_4_abb_ha_01", "weapon_mamluk_ranged_4_incendiary_abb_ha_01", "weapon_mamluk_ranged_4_incendiary_building_fire_abb_ha_01", "weapon_manatarms_1", "weapon_manatarms_1_1handmace_charge_cru", "weapon_manatarms_1_1handmace_cru", "weapon_manatarms_1_2handaxe_charge_cru", "weapon_manatarms_1_2handaxe_cru", "weapon_manatarms_1_2handmace_charge_cru", "weapon_manatarms_1_2handmace_cru", "weapon_manatarms_1_charge", "weapon_manatarms_1_charge_cru", "weapon_manatarms_1_charge_jpn", "weapon_manatarms_1_cru", "weapon_manatarms_1_eng_readability_test", "weapon_manatarms_1_jpn", "weapon_manatarms_2", "weapon_manatarms_2_1handmace_charge_cru", "weapon_manatarms_2_1handmace_charge_hre", "weapon_manatarms_2_1handmace_charge_hre_ha_01", "weapon_manatarms_2_1handmace_cru", "weapon_manatarms_2_1handmace_hre", "weapon_manatarms_2_1handmace_hre_ha_01", "weapon_manatarms_2_2handaxe_byz_ha_mac", "weapon_manatarms_2_2handaxe_charge_byz_ha_mac", "weapon_manatarms_2_2handaxe_charge_cru", "weapon_manatarms_2_2handaxe_charge_hre", "weapon_manatarms_2_2handaxe_charge_hre_ha_01", "weapon_manatarms_2_2handaxe_cru", "weapon_manatarms_2_2handaxe_hre", "weapon_manatarms_2_2handaxe_hre_ha_01", "weapon_manatarms_2_2handmace_charge_cru", "weapon_manatarms_2_2handmace_charge_hre", "weapon_manatarms_2_2handmace_charge_hre_ha_01", "weapon_manatarms_2_2handmace_cru", "weapon_manatarms_2_2handmace_hre", "weapon_manatarms_2_2handmace_hre_ha_01", "weapon_manatarms_2_byz_ha_mac", "weapon_manatarms_2_charge", "weapon_manatarms_2_charge_byz_ha_mac", "weapon_manatarms_2_charge_chi_ha_01", "weapon_manatarms_2_charge_cru", "weapon_manatarms_2_charge_hre", "weapon_manatarms_2_charge_hre_ha_01", "weapon_manatarms_2_charge_jpn", "weapon_manatarms_2_charge_mal", "weapon_manatarms_2_chi_ha_01", "weapon_manatarms_2_cru", "weapon_manatarms_2_hre", "weapon_manatarms_2_hre_ha_01", "weapon_manatarms_2_jpn", "weapon_manatarms_2_mal", "weapon_manatarms_2_rhomphaia_byz_ha_mac", "weapon_manatarms_2_rhomphaia_charge_byz_ha_mac", "weapon_manatarms_3", "weapon_manatarms_3_1handmace_charge_cru", "weapon_manatarms_3_1handmace_charge_hre", "weapon_manatarms_3_1handmace_charge_hre_ha_01", "weapon_manatarms_3_1handmace_cru", "weapon_manatarms_3_1handmace_hre", "weapon_manatarms_3_1handmace_hre_ha_01", "weapon_manatarms_3_2handaxe_byz", "weapon_manatarms_3_2handaxe_byz_ha_mac", "weapon_manatarms_3_2handaxe_charge_byz", "weapon_manatarms_3_2handaxe_charge_byz_ha_mac", "weapon_manatarms_3_2handaxe_charge_cru", "weapon_manatarms_3_2handaxe_charge_hre", "weapon_manatarms_3_2handaxe_charge_hre_ha_01", "weapon_manatarms_3_2handaxe_cru", "weapon_manatarms_3_2handaxe_hre", "weapon_manatarms_3_2handaxe_hre_ha_01", "weapon_manatarms_3_2handmace_charge_cru", "weapon_manatarms_3_2handmace_charge_hre", "weapon_manatarms_3_2handmace_charge_hre_ha_01", "weapon_manatarms_3_2handmace_cru", "weapon_manatarms_3_2handmace_hre", "weapon_manatarms_3_2handmace_hre_ha_01", "weapon_manatarms_3_abb", "weapon_manatarms_3_byz", "weapon_manatarms_3_byz_ha_mac", "weapon_manatarms_3_charge", "weapon_manatarms_3_charge_abb", "weapon_manatarms_3_charge_byz", "weapon_manatarms_3_charge_byz_ha_mac", "weapon_manatarms_3_charge_chi", "weapon_manatarms_3_charge_cru", "weapon_manatarms_3_charge_generic_abb", "weapon_manatarms_3_charge_hre", "weapon_manatarms_3_charge_hre_ha_01", "weapon_manatarms_3_charge_improved_ott", "weapon_manatarms_3_charge_improved_sul", "weapon_manatarms_3_charge_jpn", "weapon_manatarms_3_charge_mal", "weapon_manatarms_3_charge_nov", "weapon_manatarms_3_charge_ott", "weapon_manatarms_3_charge_rus", "weapon_manatarms_3_charge_sul", "weapon_manatarms_3_charge_tem", "weapon_manatarms_3_charge_upgraded_sul_ha_tug", "weapon_manatarms_3_chi", "weapon_manatarms_3_cru", "weapon_manatarms_3_generic_abb", "weapon_manatarms_3_hre", "weapon_manatarms_3_hre_ha_01", "weapon_manatarms_3_improved_ott", "weapon_manatarms_3_improved_sul", "weapon_manatarms_3_jpn", "weapon_manatarms_3_mal", "weapon_manatarms_3_nov", "weapon_manatarms_3_ott", "weapon_manatarms_3_rhomphaia_byz_ha_mac", "weapon_manatarms_3_rhomphaia_charge_byz_ha_mac", "weapon_manatarms_3_rus", "weapon_manatarms_3_sul", "weapon_manatarms_3_tem", "weapon_manatarms_3_upgraded_sul_ha_tug", "weapon_manatarms_4", "weapon_manatarms_4_1handmace_charge_cru", "weapon_manatarms_4_1handmace_charge_hre", "weapon_manatarms_4_1handmace_charge_hre_ha_01", "weapon_manatarms_4_1handmace_cru", "weapon_manatarms_4_1handmace_hre", "weapon_manatarms_4_1handmace_hre_ha_01", "weapon_manatarms_4_2handaxe_byz", "weapon_manatarms_4_2handaxe_byz_ha_mac", "weapon_manatarms_4_2handaxe_charge_byz", "weapon_manatarms_4_2handaxe_charge_byz_ha_mac", "weapon_manatarms_4_2handaxe_charge_cru", "weapon_manatarms_4_2handaxe_charge_hre", "weapon_manatarms_4_2handaxe_charge_hre_ha_01", "weapon_manatarms_4_2handaxe_cru", "weapon_manatarms_4_2handaxe_hre", "weapon_manatarms_4_2handaxe_hre_ha_01", "weapon_manatarms_4_2handmace_charge_cru", "weapon_manatarms_4_2handmace_charge_hre", "weapon_manatarms_4_2handmace_charge_hre_ha_01", "weapon_manatarms_4_2handmace_cru", "weapon_manatarms_4_2handmace_hre", "weapon_manatarms_4_2handmace_hre_ha_01", "weapon_manatarms_4_abb", "weapon_manatarms_4_byz", "weapon_manatarms_4_byz_boss_rogue", "weapon_manatarms_4_byz_ha_mac", "weapon_manatarms_4_charge", "weapon_manatarms_4_charge_abb", "weapon_manatarms_4_charge_byz", "weapon_manatarms_4_charge_byz_boss_rogue", "weapon_manatarms_4_charge_byz_ha_mac", "weapon_manatarms_4_charge_chi", "weapon_manatarms_4_charge_cru", "weapon_manatarms_4_charge_hre", "weapon_manatarms_4_charge_hre_ha_01", "weapon_manatarms_4_charge_improved_ott", "weapon_manatarms_4_charge_improved_sul", "weapon_manatarms_4_charge_jpn", "weapon_manatarms_4_charge_mal", "weapon_manatarms_4_charge_ott", "weapon_manatarms_4_charge_rus", "weapon_manatarms_4_charge_sul", "weapon_manatarms_4_charge_tem", "weapon_manatarms_4_charge_upgraded_sul_ha_tug", "weapon_manatarms_4_chi", "weapon_manatarms_4_cru", "weapon_manatarms_4_hre", "weapon_manatarms_4_hre_ha_01", "weapon_manatarms_4_improved_ott", "weapon_manatarms_4_improved_sul", "weapon_manatarms_4_jpn", "weapon_manatarms_4_mal", "weapon_manatarms_4_ott", "weapon_manatarms_4_rhomphaia_byz_ha_mac", "weapon_manatarms_4_rhomphaia_charge_byz_ha_mac", "weapon_manatarms_4_rus", "weapon_manatarms_4_sul", "weapon_manatarms_4_tem", "weapon_manatarms_4_upgraded_sul_ha_tug", "weapon_manatarms_aoe_sweep_chi", "weapon_manatarms_elite_chi", "weapon_manatarms_mon_3", "weapon_manatarms_mon_4", "weapon_mangonel_3", "weapon_mangonel_3_improved_eng", "weapon_mangonel_3_improved_nrm", "weapon_mangonel_3_incendiary", "weapon_mangonel_3_incendiary_mon", "weapon_mangonel_3_incendiary_nov", "weapon_mangonel_3_incendiary_rus", "weapon_mangonel_3_mon", "weapon_mangonel_3_nov", "weapon_mangonel_3_rus", "weapon_mangonel_4_adjustable_crossbars", "weapon_mangonel_rogue", "weapon_mansa_javelin_2", "weapon_mansa_javelin_3", "weapon_mansa_javelin_4", "weapon_mansa_musofadi_2_charge_mal", "weapon_mansa_musofadi_2_mal", "weapon_mansa_musofadi_3_charge_mal", "weapon_mansa_musofadi_3_mal", "weapon_mansa_musofadi_4_charge_mal", "weapon_mansa_musofadi_4_mal", "weapon_mehter_2_ott", "weapon_messenger_eagle_mon_ha_gol", "weapon_militia", "weapon_militia_charge_cru", "weapon_militia_cru", "weapon_militia_rogue", "weapon_militia_rogue_charge", "weapon_ming_guard_charge_chi", "weapon_ming_guard_chi", "weapon_monk_3_charge_rus", "weapon_monk_3_rus", "weapon_monk_shaolin_3_chi", "weapon_mounted_maa_2_charge_lan", "weapon_mounted_maa_2_charge_lan_esses", "weapon_mounted_maa_2_lan", "weapon_mounted_maa_2_lan_esses", "weapon_mounted_maa_3_charge_lan", "weapon_mounted_maa_3_charge_lan_esses", "weapon_mounted_maa_3_lan", "weapon_mounted_maa_3_lan_esses", "weapon_mounted_maa_4_charge_lan", "weapon_mounted_maa_4_charge_lan_esses", "weapon_mounted_maa_4_lan", "weapon_mounted_maa_4_lan_esses", "weapon_mounted_samurai_3_charge_jpn", "weapon_mounted_samurai_3_jpn", "weapon_mounted_samurai_4_charge_jpn", "weapon_mounted_samurai_4_jpn", "weapon_mounted_samurai_odachi_3_jpn_ha_sen", "weapon_mounted_samurai_odachi_4_jpn_ha_sen", "weapon_naval_arrow_ship_arrow", "weapon_naval_arrow_ship_incendiary", "weapon_naval_combat_ship_arrow_abb", "weapon_naval_combat_ship_arrow_sul", "weapon_naval_combat_ship_crossbow", "weapon_naval_combat_ship_crossbow_asian", "weapon_naval_combat_ship_crossbow_eastern", "weapon_naval_combat_ship_crossbow_forecastle", "weapon_naval_combat_ship_crossbow_second_ballista", "weapon_naval_combat_ship_crossbow_second_ballista_eng", "weapon_naval_combat_ship_crossbow_vis", "weapon_naval_combat_ship_crossbow_western", "weapon_naval_combat_ship_crossbow_western_eng", "weapon_naval_combat_ship_culverin", "weapon_naval_combat_ship_culverin_forecastle", "weapon_naval_combat_ship_culverin_vis", "weapon_naval_combat_ship_springald", "weapon_naval_combat_ship_springald_cru", "weapon_naval_combat_ship_springald_flaming_tem", "weapon_naval_combat_ship_springald_fre", "weapon_naval_combat_ship_swivel_ballista", "weapon_naval_dhow_arrow_abb", "weapon_naval_fire_arrows_cru", "weapon_naval_fireship", "weapon_naval_fireship_explosive", "weapon_naval_fireship_incendiaries", "weapon_naval_fireship_incendiaries_explosive", "weapon_naval_fireship_upgraded_byz", "weapon_naval_fireship_upgraded_explosives_byz", "weapon_naval_fishing_ship_arrow", "weapon_naval_fishing_ship_arrow_sul", "weapon_naval_galleass_bombard_fre", "weapon_naval_galley_bombard_ott", "weapon_naval_javelin", "weapon_naval_javelin_burst", "weapon_naval_javelin_mal", "weapon_naval_lodya_arrow_incendiary_rus", "weapon_naval_lodya_arrow_incendiary_vis_rus", "weapon_naval_lodya_arrow_rus", "weapon_naval_lodya_arrow_vis_rus", "weapon_naval_mounted_gun", "weapon_naval_nest_of_bees_4_chi", "weapon_naval_swivel_cannon", "weapon_naval_war_galley_bombard", "weapon_naval_war_galley_springald", "weapon_naval_warship_cannon", "weapon_naval_warship_cannon_ai", "weapon_naval_warship_cannon_ai_asian", "weapon_naval_warship_cannon_ai_eastern", "weapon_naval_warship_cannon_ai_western", "weapon_naval_warship_cannon_ai_western_eng", "weapon_naval_warship_cannon_asian", "weapon_naval_warship_cannon_eastern", "weapon_naval_warship_cannon_western", "weapon_naval_warship_cannon_western_eng", "weapon_naval_warship_chain_cannon", "weapon_naval_warship_chain_cannon_ai", "weapon_naval_warship_rocket_ai_jpn", "weapon_naval_warship_rocket_jpn", "weapon_naval_warship_springald", "weapon_naval_warship_springald_ai", "weapon_nest_of_bees_4_chi", "weapon_nest_of_bees_4_improved_chi", "weapon_nest_of_bees_4_incendiary_chi", "weapon_nest_of_bees_4_larger_aoe_chi", "weapon_nest_of_bees_4_viz_chi", "weapon_nest_of_bees_rogue", "weapon_odachi_1_charge_jpn", "weapon_odachi_1_jpn", "weapon_odachi_2_charge_jpn", "weapon_odachi_2_jpn", "weapon_odachi_3_charge_jpn", "weapon_odachi_3_jpn", "weapon_odachi_4_charge_jpn", "weapon_odachi_4_jpn", "weapon_odo_charge_cmp_tem", "weapon_odo_cmp_tem", "weapon_onna_bugeisha_2_charge_jpn", "weapon_onna_bugeisha_2_jpn", "weapon_onna_bugeisha_3_charge_jpn", "weapon_onna_bugeisha_3_jpn", "weapon_onna_bugeisha_4_charge_jpn", "weapon_onna_bugeisha_4_jpn", "weapon_outpost_arrows", "weapon_outpost_arrows_garrison", "weapon_outpost_bolts_garrison_ott", "weapon_outpost_cannon", "weapon_outpost_handcannon_chi", "weapon_outpost_javelin_mal", "weapon_outpost_mangonel", "weapon_outpost_murder_hole", "weapon_outpost_springald", "weapon_ozutsu_3_jpn_ha_sen", "weapon_ozutsu_4_jpn", "weapon_ozutsu_4_jpn_ha_sen", "weapon_ozutsu_large_aoe_3_jpn_ha_sen", "weapon_ozutsu_large_aoe_4_jpn_ha_sen", "weapon_photon_man_crop_circle", "weapon_photontrooper", "weapon_pirate_abb_ha_01", "weapon_pirate_archer_ayy", "weapon_pirate_ayy", "weapon_ram_3", "weapon_ram_3_mon", "weapon_ram_3_nov", "weapon_ram_3_rus", "weapon_ram_4", "weapon_ram_4_rus", "weapon_ram_flame_thrower_byz", "weapon_ram_supa", "weapon_ram_tower", "weapon_ram_tower_3_abb_ha_01", "weapon_ram_tower_arrow_cru", "weapon_range_dummy_horse_hack", "weapon_repeater_crossbow_2_chi", "weapon_repeater_crossbow_2_library_upgrade_chi_ha_01", "weapon_repeater_crossbow_2_library_upgrade_incendiary_chi_ha_01", "weapon_repeater_crossbow_3_chi", "weapon_repeater_crossbow_3_library_upgrade_chi_ha_01", "weapon_repeater_crossbow_3_library_upgrade_incendiary_chi_ha_01", "weapon_repeater_crossbow_4_chi", "weapon_repeater_crossbow_4_lib_incendiary_building_fire_chi_ha_01", "weapon_repeater_crossbow_4_library_upgrade_chi_ha_01", "weapon_repeater_crossbow_4_library_upgrade_incendiary_chi_ha_01", "weapon_repeater_crossbow_incendiary_3_chi", "weapon_repeater_crossbow_incendiary_4_chi", "weapon_repeater_crossbow_incendiary_building_fire_chi", "weapon_repeater_crossbow_incendiary_chi", "weapon_ribauldequin_4", "weapon_ribauldequin_4_form_fre", "weapon_ribauldequin_4_royal_fre", "weapon_ribauldequin_4_rus", "weapon_riddari_3_byz_ha_mac", "weapon_riddari_4_byz_ha_mac", "weapon_ronin_1_charge_neu", "weapon_ronin_1_neu", "weapon_rus_tributes_3_charge_mon_ha_gol", "weapon_rus_tributes_3_mon_ha_gol", "weapon_rus_tributes_4_charge_mon_ha_gol", "weapon_rus_tributes_4_mon_ha_gol", "weapon_samurai_katana_1_jpn", "weapon_samurai_katana_2_jpn", "weapon_samurai_katana_3_jpn", "weapon_samurai_katana_4_jpn", "weapon_scorpion_3_improved_eng", "weapon_scorpion_3_improved_nrm", "weapon_scout_1", "weapon_scout_1_chi", "weapon_scout_1_fre", "weapon_scout_1_jeanne_fre_ha_01", "weapon_scout_1_jpn", "weapon_scout_1_mal", "weapon_scout_1_nov", "weapon_scout_1_rus", "weapon_scout_2_mal", "weapon_scout_3_mal", "weapon_scout_4_mal", "weapon_scout_champion_byz_ha_mac", "weapon_scout_hunt_ranged_1", "weapon_scout_hunt_ranged_1_jeanne_fre_ha_01", "weapon_scout_hunt_ranged_1_nov", "weapon_scout_hunt_ranged_1_rus", "weapon_serjeant_2_tem", "weapon_serjeant_3_tem", "weapon_serjeant_4_tem", "weapon_settlement_arrowslits", "weapon_shield_militia_2_rus", "weapon_shield_villager_cmp_axe_eng", "weapon_shield_villager_cmp_axe_rus", "weapon_shield_villager_cmp_eng", "weapon_shield_villager_cmp_fre", "weapon_shieldwall_hastings_charge_cmp_eng", "weapon_shieldwall_hastings_cmp_eng", "weapon_shinobi_2_jpn", "weapon_shinobi_2_jpn_ha_sen", "weapon_shinobi_grenade", "weapon_shogun_tokugawa_charge_rogue", "weapon_shogun_tokugawa_rogue", "weapon_siege_dummy", "weapon_spearman_1", "weapon_spearman_1_byz", "weapon_spearman_1_charge", "weapon_spearman_1_charge_byz", "weapon_spearman_1_charge_fire_chi_ha_01", "weapon_spearman_1_charge_hre_ha_01", "weapon_spearman_1_charge_mal", "weapon_spearman_1_charge_rus", "weapon_spearman_1_charge_tem", "weapon_spearman_1_hre_ha_01", "weapon_spearman_1_improved_charge_sul_ha_tug", "weapon_spearman_1_improved_sul_ha_tug", "weapon_spearman_1_mal", "weapon_spearman_1_rus", "weapon_spearman_1_tem", "weapon_spearman_2", "weapon_spearman_2_byz", "weapon_spearman_2_charge", "weapon_spearman_2_charge_byz", "weapon_spearman_2_charge_fire_chi_ha_01", "weapon_spearman_2_charge_hre_ha_01", "weapon_spearman_2_charge_mal", "weapon_spearman_2_charge_rus", "weapon_spearman_2_charge_tem", "weapon_spearman_2_hre_ha_01", "weapon_spearman_2_improved_charge_sul_ha_tug", "weapon_spearman_2_improved_sul_ha_tug", "weapon_spearman_2_mal", "weapon_spearman_2_rus", "weapon_spearman_2_tem", "weapon_spearman_3", "weapon_spearman_3_byz", "weapon_spearman_3_charge", "weapon_spearman_3_charge_byz", "weapon_spearman_3_charge_fire_chi_ha_01", "weapon_spearman_3_charge_hre_ha_01", "weapon_spearman_3_charge_mal", "weapon_spearman_3_charge_nov", "weapon_spearman_3_charge_rus", "weapon_spearman_3_charge_tem", "weapon_spearman_3_hre_ha_01", "weapon_spearman_3_improved_charge_sul_ha_tug", "weapon_spearman_3_improved_sul_ha_tug", "weapon_spearman_3_mal", "weapon_spearman_3_nov", "weapon_spearman_3_rus", "weapon_spearman_3_tem", "weapon_spearman_4", "weapon_spearman_4_byz", "weapon_spearman_4_charge", "weapon_spearman_4_charge_byz", "weapon_spearman_4_charge_fire_chi_ha_01", "weapon_spearman_4_charge_hre_ha_01", "weapon_spearman_4_charge_mal", "weapon_spearman_4_charge_rus", "weapon_spearman_4_charge_tem", "weapon_spearman_4_hre_ha_01", "weapon_spearman_4_improved_charge_sul_ha_tug", "weapon_spearman_4_improved_sul_ha_tug", "weapon_spearman_4_mal", "weapon_spearman_4_rus", "weapon_spearman_4_tem", "weapon_spearman_charge_rogue", "weapon_spearman_improved_spearwall_1_sul_ha_tug", "weapon_spearman_improved_spearwall_2_sul_ha_tug", "weapon_spearman_improved_spearwall_3_sul_ha_tug", "weapon_spearman_improved_spearwall_4_sul_ha_tug", "weapon_spearman_light_2_charge_jpn_ha_sen", "weapon_spearman_light_1_charge_jpn_ha_sen", "weapon_spearman_light_1_jpn_ha_sen", "weapon_spearman_light_2_jpn_ha_sen", "weapon_spearman_light_3_charge_jpn_ha_sen", "weapon_spearman_light_3_jpn_ha_sen", "weapon_spearman_light_4_charge_jpn_ha_sen", "weapon_spearman_light_4_jpn_ha_sen", "weapon_spearman_long_1_charge_jpn", "weapon_spearman_long_2_charge_jpn", "weapon_spearman_long_3_charge_jpn", "weapon_spearman_long_4_charge_jpn", "weapon_spearman_long_spear_1_jpn", "weapon_spearman_long_spear_2_jpn", "weapon_spearman_long_spear_3_jpn", "weapon_spearman_long_spear_4_jpn", "weapon_spearman_rogue", "weapon_spearwall_1", "weapon_spearwall_1_hre_ha_01", "weapon_spearwall_1_rus", "weapon_spearwall_2", "weapon_spearwall_2_hre_ha_01", "weapon_spearwall_2_rus", "weapon_spearwall_3", "weapon_spearwall_3_hre_ha_01", "weapon_spearwall_3_nov", "weapon_spearwall_3_rus", "weapon_spearwall_4", "weapon_spearwall_4_hre_ha_01", "weapon_spearwall_4_rus", "weapon_spearwall_light_1_jpn_ha_sen", "weapon_spearwall_light_2_jpn_ha_sen", "weapon_spearwall_light_3_jpn_ha_sen", "weapon_spearwall_light_4_jpn_ha_sen", "weapon_spearwall_long_1_jpn", "weapon_spearwall_long_2_jpn", "weapon_spearwall_long_3_jpn", "weapon_spearwall_long_4_jpn", "weapon_spearwall_tem_1", "weapon_spearwall_tem_2", "weapon_spearwall_tem_3", "weapon_spearwall_tem_4", "weapon_springald_3", "weapon_springald_3_elephant_ballista_sul_ha_tug", "weapon_springald_3_flaming_byz_ha_mac", "weapon_springald_3_mon", "weapon_springald_3_nov", "weapon_springald_3_rus", "weapon_springald_4_elephant_ballista_sul_ha_tug", "weapon_springald_champion_rogue", "weapon_spy_ayy", "weapon_spy_stealth_strike_ayy", "weapon_spy_torch_ayy", "weapon_stone_walls_arrows_tem", "weapon_szlachta_4_charge_tem", "weapon_szlachta_4_tem", "weapon_tc_rocket_jpn", "weapon_teutonic_champion_charge_rogue", "weapon_teutonic_champion_rogue", "weapon_teutonic_knight_4_charge_tem", "weapon_teutonic_knight_4_tem", "weapon_torch", "weapon_torch_dragon_fire_hre_ha_01", "weapon_torch_elephant_archer_sul", "weapon_torch_horseman", "weapon_torch_horseman_hre_ha_01", "weapon_torch_horseman_mon", "weapon_torch_horseman_no_burn_mon", "weapon_torch_horseman_rus", "weapon_torch_hre_ha_01", "weapon_torch_ikko_ikki_jpn_ha_sen", "weapon_torch_jeanne", "weapon_torch_khan_mon", "weapon_torch_khan_no_burn_mon", "weapon_torch_knight_hre_ha_01", "weapon_torch_lancer_mon", "weapon_torch_mon", "weapon_torch_no_burn_mon", "weapon_torch_no_burn_weak_mon", "weapon_torch_rus", "weapon_torch_strong", "weapon_torch_strong_cmp", "weapon_torch_weak", "weapon_torch_weak_hre_ha_01", "weapon_torch_weak_mon", "weapon_torch_weak_rus", "weapon_tower_war_elephant_melee_sul", "weapon_tower_war_elephant_ram_3_sul", "weapon_town_center_arrows", "weapon_town_center_arrows_b_eng", "weapon_town_center_arrows_b_nrm", "weapon_town_center_arrows_garrison", "weapon_town_center_arrows_garrison_non_capital_additional_tc", "weapon_town_center_bolts_garrison_non_capital_ott", "weapon_town_center_bolts_garrison_ott", "weapon_town_center_handcannon_chi", "weapon_town_center_handcannon_garrison_chi", "weapon_trade_cart_guard", "weapon_trebuchet_4_counterweight", "weapon_trebuchet_4_counterweight_aoe_eng", "weapon_trebuchet_4_counterweight_aoe_nrm", "weapon_trebuchet_4_counterweight_shatter_eng", "weapon_trebuchet_4_counterweight_shatter_nrm", "weapon_trebuchet_4_cw_double_tem", "weapon_trebuchet_4_cw_improved_eng", "weapon_trebuchet_4_cw_improved_nrm", "weapon_trebuchet_4_cw_rus", "weapon_trebuchet_4_greek_fire", "weapon_trebuchet_4_ship_double_tem", "weapon_trebuchet_4_siege_double_tem", "weapon_trebuchet_4_tr_improved_eng", "weapon_trebuchet_4_tr_improved_nrm", "weapon_trebuchet_4_tr_rus", "weapon_trebuchet_4_traction", "weapon_trebuchet_4_traction_mon", "weapon_trebuchet_aoe_threat_rogue", "weapon_trebuchet_barrage", "weapon_trebuchet_naptha_shot_mon_ha_gol", "weapon_tughluqabad_fort", "weapon_tughluqabad_fort_garrison", "weapon_turkic_horsearcher_2_ayy", "weapon_turkic_horsearcher_3_ayy", "weapon_turkic_horsearcher_4_ayy", "weapon_turkic_horsearcher_incendiary_2_ayy", "weapon_turkic_horsearcher_incendiary_3_ayy", "weapon_turkic_horsearcher_incendiary_4_ayy", "weapon_turkic_horsearcher_moving_2_ayy", "weapon_turkic_horsearcher_moving_3_ayy", "weapon_turkic_horsearcher_moving_4_ayy", "weapon_turkic_horsearcher_moving_incendiary_2_ayy", "weapon_turkic_horsearcher_moving_incendiary_3_ayy", "weapon_turkic_horsearcher_moving_incendiary_4_ayy", "weapon_varangian_stronghold_arrows_byz_ha_mac", "weapon_villager_1", "weapon_villager_1_hre_ha_01", "weapon_villager_1_rus", "weapon_villager_akritoi_1", "weapon_villager_akritoi_2", "weapon_villager_akritoi_3", "weapon_villager_akritoi_4", "weapon_villager_hunt_herd", "weapon_villager_hunt_melee", "weapon_villager_hunt_ranged", "weapon_villager_hunt_ranged_eng", "weapon_villager_militarized_2_eng", "weapon_villager_militarized_2_nrm", "weapon_walltower_arrows", "weapon_walltower_arrows_garrison", "weapon_walltower_cannon", "weapon_walltower_handcannon_chi", "weapon_walltower_handcannon_garrison_chi", "weapon_walltower_mangonel", "weapon_walltower_murder_hole", "weapon_walltower_springald", "weapon_war_elephant_charge_3_sul", "weapon_war_elephant_charge_3_sul_ha_tug", "weapon_war_elephant_healer_sul_ha_tug", "weapon_war_elephant_melee_3_sul", "weapon_war_elephant_melee_3_sul_ha_tug", "weapon_war_elephant_raider_charge_2_sul_ha_tug", "weapon_war_elephant_raider_charge_3_sul_ha_tug", "weapon_war_elephant_raider_charge_4_sul_ha_tug", "weapon_war_elephant_raider_melee_2_sul_ha_tug", "weapon_war_elephant_raider_melee_3_sul_ha_tug", "weapon_war_elephant_raider_melee_4_sul_ha_tug", "weapon_war_elephant_ram_3_sul", "weapon_war_elephant_spear_3_sul", "weapon_war_elephant_tower_archer_4_sul", "weapon_war_elephant_tower_crossbow_4_sul", "weapon_war_elephant_tower_handcannon_4_sul", "weapon_white_tower_springald_eng", "weapon_white_tower_springald_nrm", "weapon_willikin_eng", "weapon_willikin_incendiary", "weapon_womanatarms_3_charge_jeanne_fre_ha_01", "weapon_womanatarms_3_jeanne_fre_ha_01", "weapon_wooden_fort_arrows_garrison", "weapon_wooden_fort_springald_a_rus", "weapon_wooden_fort_springald_b_rus", "weapon_wynguard_footman_charge_eng_4", "weapon_wynguard_footman_eng_4", "weapon_wynguard_ranger_eng_4", "weapon_wynguard_ranger_incen_building_fire_eng", "weapon_wynguard_ranger_incen_eng_4", "weapon_yeoman_2_lan", "weapon_yeoman_3_lan", "weapon_yeoman_4_lan", "weapon_yeoman_incendiary_2_lan", "weapon_yeoman_incendiary_3_lan", "weapon_yeoman_incendiary_4_lan", "weapon_yeoman_incendiary_building_fire_lan", "weapon_yeoman_synchronized_shot_2", "weapon_yeoman_synchronized_shot_3", "weapon_yeoman_synchronized_shot_4", "weapon_yuan_guard_chi_ha_01", "werewolf_attack_dangerous_1", "werewolf_attack_dangerous_1_charge", "werewolf_attack_dangerous_1_siege", "werewolf_attack_dangerous_2", "werewolf_attack_dangerous_2_charge", "werewolf_attack_dangerous_2_siege", "werewolf_attack_dangerous_3", "werewolf_attack_dangerous_3_charge", "werewolf_attack_dangerous_3_siege", "werewolf_attack_dangerous_4", "werewolf_attack_dangerous_4_charge", "werewolf_attack_dangerous_4_siege", "wolf_attack_dangerous" }

-- MARK: Logging
RND_DO_LOGGING = Misc_IsDevMode()
function RND_Print(info)
	if RND_DO_LOGGING then
		print(info)
	end
end

RND_MEASUREMENTS = {}
function RND_MeasureStart(name)
	if RND_DO_LOGGING then
		RND_Print("Measurement " .. name .. " started")
		RND_MEASUREMENTS[name] = 0.0 --how tf is there no way to get current milliseconds. RELIC?!?!?
	end
end
function RND_MeasureEnd(name)
	if RND_DO_LOGGING then
		if RND_MEASUREMENTS[name] == nil then
			RND_Print("Measurement " .. name .. " doesn't exist")
		else
			RND_Print("Measurement " .. name .. " finished")
			RND_MEASUREMENTS[name] = nil
		end
	end
end

-- end logging helpers

RND_Rand_Count = 0
RND_Chance_Count = 0
RND_Modifier_Create_Count = 0
RND_Modifier_Apply_Count = 0

RND_MeasureStart("initial_setup")

--MARK: Helpers
-- Random float helper
function RND_Rand(min, max)
	if RND_DO_LOGGING then RND_Rand_Count = RND_Rand_Count + 1 end
    return min + (max - min) * RND_BaseRand()
end

function RND_BaseRand()
	return World_GetRand(0, 1000000) / 1000000.0
end

function RND_RandInt(min, max)
    return World_GetRand(min, max)
end

function RND_Chance(chance_decimal)
	if RND_DO_LOGGING then RND_Chance_Count = RND_Chance_Count + 1 end
	if(World_GetRand(0, 99) < chance_decimal * 100) then
		return 1
	else return 0
	end
end


-- optimized general-purpose function for applying modifiers to all players
function RND_Modify(bp, type, value, mut_type, mat_type)

	if mut_type == nil then mut_type = MUT_Multiplication end
	if mat_type == nil then mat_type = MAT_EntityType end

	if mut_type == MUT_Multiplication and RND_value == 1 then return end
	if mut_type == MUT_Addition and RND_value == 0 then return end

	local m = Modifier_Create(mat_type, type, mut_type, false, value, bp)

	if RND_DO_LOGGING then RND_Modifier_Create_Count = RND_Modifier_Create_Count + 1 end
	for _, player in pairs(PLAYERS) do
		if RND_DO_LOGGING then RND_Modifier_Apply_Count = RND_Modifier_Apply_Count + 1 end
		Modifier_ApplyToPlayer(m, player.id, 0.0)
	end
end


-- MARK: Options
RND_BP_UNIT_CLASS = "annihilation_condition" -- goofy ahh unit class name
RND_BP_WORKER = "worker"
RND_BP_BUILDING = "building"
RND_BP_UPGRADE = "upgrade"
RND_BP_GAIA = "gaia"
RND_BP_TOWN_CENTER = "town_center"
RND_BP_ECON_BUILDING = "economy_building"
RND_BP_WALL = "wall"
RND_BP_HOUSE = "house"
RND_BP_WONDERS_AND_LANDMARKS = "wonder"
RND_BP_FARM = "farm"

RND_OPTIONS = {
	win = { -- win conditions
		la = true, -- landmark
		sa = true, -- sacred
		wo = true, -- wonder
	},
	mch = { -- match options
		sc = false, -- show scores
		ma = "concealed", -- map state
		re = false -- reveal on elim
	}
}

function RND_DealWithOptions()
	local options = { }
	Setup_GetWinConditionOptions(options)
	
	if not options then
		return
	end
	
	if options.section_win_conditions then
		if options.section_win_conditions.option_win_condition_landmarks ~= nil then RND_OPTIONS.win.la = options.section_win_conditions.option_win_condition_landmarks end
		if options.section_win_conditions.option_win_condition_sacred ~= nil then RND_OPTIONS.win.sa = options.section_win_conditions.option_win_condition_sacred end
		if options.section_win_conditions.option_win_condition_wonder ~= nil then RND_OPTIONS.win.wo = options.section_win_conditions.option_win_condition_wonder end
	end
	
	if options.section_match_options then
		if options.section_match_options.option_match_option_scores ~= nil then RND_OPTIONS.mch.sc = options.section_match_options.option_match_option_scores end
		if options.section_match_options.enum_map_state then
			if options.section_match_options.enum_map_state.enum_value == options.section_match_options.enum_map_state.enum_items.map_state_concealed then
				RND_OPTIONS.mch.ma = "concealed"
			elseif options.section_match_options.enum_map_state.enum_value == options.section_match_options.enum_map_state.enum_items.map_state_explored then
				RND_OPTIONS.mch.ma = "explored"
			elseif options.section_match_options.enum_map_state.enum_value == options.section_match_options.enum_map_state.enum_items.map_state_revealed then
				RND_OPTIONS.mch.ma = "revealed"
			end
		end
		if options.section_match_options.option_reveal_on_elimination ~= nil then RND_OPTIONS.mch.re = options.section_match_options.option_reveal_on_elimination end
	end
end


function RND_OnGameSetup()
	RND_MeasureStart("RND_OnGameSetup")

	RND_DealWithOptions()
	
	-- import necessary win conditions
	
	if RND_OPTIONS.win.la then
		import("winconditions/conquest.scar")       -- landmark destruction (original Landmark Victory) 
	end
	if RND_OPTIONS.win.wo then
		import("winconditions/wonder.scar")         -- Wonder defense victory
	end
	if RND_OPTIONS.win.sa then
		import("winconditions/religious.scar")      -- Sacred site/reflic victory
	end

	RND_MeasureEnd("RND_OnGameSetup")
end

--MARK: _PreInit
function RND_PreInit()
	RND_MeasureStart("RND_PreInit: Resources, Population")
	Core_CallDelegateFunctions("DiplomacyEnabled", true)
	Core_CallDelegateFunctions("TributeEnabled", true)
	
	
	local rFood = RND_RandInt(0, 200*2)
	local rWood = RND_RandInt(0, 150*2)
	local rGold = RND_RandInt(0, 100*2)
	local rStone = RND_RandInt(0, 100*2)
	
	for _, player in pairs(PLAYERS) do
		Player_SetResource(player.id, RT_Food, rFood)
		Player_SetResource(player.id, RT_Wood, rWood)
		Player_SetResource(player.id, RT_Gold, rGold)
		Player_SetResource(player.id, RT_Stone, rStone)
	end
	
	RND_PopChange(RND_RandInt(0, 100), RND_RandInt(375, 425))
	RND_MeasureEnd("RND_PreInit: Resources, Population")

	RND_MeasureStart("RND_PreInit: Finding All Buildings, Workers, Unit Class")
	local buildings_workers_units = BP_GetEntityBlueprintsWithType({RND_BP_BUILDING, RND_BP_WORKER, RND_BP_UNIT_CLASS})
	RND_MeasureEnd("RND_PreInit: Finding All Buildings, Workers, Unit Class")

	RND_Print("Found " .. (#buildings_workers_units) .. " Buildings, workers, units")

	RND_MeasureStart("RND_PreInit: Buildings, Workers, Unit Class")
	RND_ApplyBonus(buildings_workers_units)
	RND_MeasureEnd("RND_PreInit: Buildings, Workers, Unit Class")

	
	-- doesn't work properly
	--RND_ApplyBonusToResourceDep(BP_GetEntityBlueprintsWithType(RND_BP_GAIA))
	
	--MARK: Weapons
	--local numWeapons = BP_GetPropertyBagGroupCount()
	
	--for i=1,numWeapons do
		--RND_Print(BP_GetPropertyBagGroupPathName("PBG_Weapon", i))
	--end
	
	
	RND_MeasureStart("RND_PreInit: Weapons")
	for _, wpn_name in pairs(listOfAllWeapons) do
		local rates = {
			damage = 2.0 ^ RND_Rand(-2, 2),
			--accuracy = RND_Rand(0.5, 1.5),
			range = 2.0 ^ RND_Rand(-1.5, 1.5),
			atk_time_mult = RND_Rand(RND_Rand(0.0, 0.03), RND_Rand(1.2, 1.7)),
			burst_rate = 2.0 ^ RND_Rand(-1.5, 2.5),
			siege_setup = RND_Rand(0.0, 1.6),
			bonus_dmg_vs_type = 2.0 ^ RND_Rand(-1, 1) + 2.0 ^ RND_Rand(-2, 2) * RND_Chance(0.1)
		}
		if RND_Chance(0.03) == 1 then
			rates.atk_time_mult = RND_Rand(0.0, 0.15)
		end
		local bp = BP_GetWeaponBlueprint(wpn_name)

		RND_Modify(bp, "damage_weapon_modifier", rates.damage, MUT_Multiplication, MAT_WeaponType)
		RND_Modify(bp, "range_weapon_modifier", rates.range, MUT_Multiplication, MAT_WeaponType)
		
		RND_Modify(bp, "reload_weapon_modifier", rates.atk_time_mult, MUT_Multiplication, MAT_WeaponType)
		RND_Modify(bp, "cooldown_weapon_modifier", rates.atk_time_mult, MUT_Multiplication, MAT_WeaponType)
		RND_Modify(bp, "weapon_wind_up_modifier", rates.atk_time_mult, MUT_Multiplication, MAT_WeaponType)
		RND_Modify(bp, "weapon_wind_down_modifier", rates.atk_time_mult, MUT_Multiplication, MAT_WeaponType)

		RND_Modify(bp, "weapon_setup_modifier", rates.siege_setup, MUT_Multiplication, MAT_WeaponType)
		RND_Modify(bp, "weapon_teardown_modifier", rates.siege_setup, MUT_Multiplication, MAT_WeaponType)
		
		--"accuracy_weapon_modifier"
		
		RND_Modify(bp, "weapon_burst_rate_of_fire_modifier", rates.burst_rate, MUT_Multiplication, MAT_WeaponType)
		RND_Modify(bp, "weapon_damage_per_unit_type_modifier", rates.bonus_dmg_vs_type, MUT_Multiplication, MAT_WeaponType)
		end
	RND_MeasureEnd("RND_PreInit: Weapons")
	
end

--MARK: _OnInit
function RND_OnInit()

	-- BENCHMARK
	-- if RND_DO_LOGGING then
	-- 	local ubp = BP_GetUpgradesMatchingTypes({"military_upgrade", "economic_upgrade", "scar_tiered_upgrade", "rus_upgrade", "ottoman_upgrade", "mongol_upgrade", "malian_upgrade", "japanese_upgrade", "hre_upgrade", "french_upgrade", "french_ha_01_upgrade", "english_upgrade", "chinese_ha_01_upgrade","chinese_upgrade", "byzantine_upgrade", "ayyubid_cmp_upgrade", "abbasid_ha_01_upgrade", "abbasid_upgrade",})[1]
	-- 	local ebp = BP_GetEntityBlueprintsWithType({RND_BP_BUILDING, RND_BP_WORKER, RND_BP_UNIT_CLASS})[1]
	-- 	local rates_cost_mult_food = RND_Rand(0.1, 2.0) + RND_Rand(1.0, 6.0) * RND_Chance(0.05),

	-- 	RND_MeasureStart("Doing rates calculation 5000 times")
	-- 	for i = 1, 5000 do

	-- 	end
	-- 	RND_MeasureEnd("Doing rates calculation 5000 times")
	-- end 
	-- end of benchmark


	RND_MeasureStart("RND_OnInit: Upgrades")
	-- upgrade modifiers
	local upgradebps = BP_GetUpgradesMatchingTypes({
			"military_upgrade", "economic_upgrade", "scar_tiered_upgrade", "rus_upgrade", "ottoman_upgrade", "mongol_upgrade", 
			"malian_upgrade", "japanese_upgrade", "hre_upgrade", "french_upgrade", "french_ha_01_upgrade", "english_upgrade", "chinese_ha_01_upgrade",
			"chinese_upgrade", "byzantine_upgrade", "ayyubid_cmp_upgrade", "abbasid_ha_01_upgrade", "abbasid_upgrade",
	})
	RND_Print("Found " .. #upgradebps .. " ubps")
	RND_ApplyUpgradeBonus(upgradebps)
	RND_MeasureEnd("RND_OnInit: Upgrades")
	
	-- map vision
	if RND_OPTIONS.mch.ma == "concealed" then 
		
	elseif RND_OPTIONS.mch.ma == "explored" then 
		FOW_ExploreAll()
	elseif RND_OPTIONS.mch.ma == "revealed" then
		FOW_ForceRevealAllUnblockedAreas()
	end
	
	-- show scores
	if RND_OPTIONS.mch.sc then
		for _, player in pairs(PLAYERS) do
			player.scarModel.show_actual_score = true
			UI_SetPlayerDataContext(player.id, player.scarModel)
		end
	end
end



RND_LOCAL_PLAYER = nil -- used for revealing on elimination
function RND_OnPlayerDefeated(player, reason)
	if player == RND_LOCAL_PLAYER then
		FOW_UIRevealAll()
	end
end

function RND_LocalPlayerChange(context)
	if context ~= nil and context.player ~= nil then
		RND_LOCAL_PLAYER = Core_GetPlayersTableEntry(context.player)
	end
end

-- MARK: _Start
-- Randomizes gaia
function RND_Start()
	RND_MeasureStart("RND_Start: Gaia(Resource Deposits)")
	RND_LocalPlayerChange({ player = Game_GetLocalPlayer() })
	Rule_AddGlobalEvent(RND_LocalPlayerChange, GE_LocalPlayerChanged)
	
	
	-- randomize gaia resources
	World_GetAllEntitiesOfType(EGroup_Create("RND_forage"), "forage_bush")
	World_GetAllEntitiesOfType(EGroup_Create("RND_deposits"), "resource_improvable")
	World_GetAllEntitiesOfType(EGroup_Create("RND_shore"), "shore_fish")
	World_GetAllEntitiesOfType(EGroup_Create("RND_deep"), "deep_water_fish")
	
	--World_GetAllEntitiesOfType(EGroup_Create("RND_all_animal"), "animal")
	
	local RandomizeRes = function( egroupid, itemindex, entityID )
		local rates = {
			mult = 2.5 ^ RND_Rand(-1, 1) + RND_Rand(5.0, 10.0) * RND_Chance(0.05),
		}

		local contained_deposit = Entity_GetRemainingResourceDepositAmount(entityID)
		Entity_SetRemainingResourceDepositAmount(entityID, math.floor(contained_deposit * rates.mult))
 	end
	
	-- doesnt work
	--local RandomizeResAnimal = function( egroupid, itemindex, entityID )
		--local rates = {
			--mult = 2.5 ^ RND_Rand(-1, 1) + RND_Rand(5.0, 10.0) * RND_Chance(0.05),
			--swap_resource = RND_Chance(0.1) == 1,
		--}
		
		---- get resources contained if this is an animal
		--local an_food_contained = Entity_GetResource(entityID, RT_Food)
		--local an_wood_contained = Entity_GetResource(entityID, RT_Wood)
		--local an_gold_contained = Entity_GetResource(entityID, RT_Gold)
		--local an_stone_contained = Entity_GetResource(entityID, RT_Stone)

		--local contained_animal_amount = math.max(an_food_contained, an_wood_contained, an_gold_contained, an_stone_contained)
		
		--local contained_animal_resource
		--if contained_animal_amount == an_food_contained then
		    --contained_animal_resource = RT_Food
		--elseif contained_animal_amount == an_wood_contained then
		    --contained_animal_resource = RT_Wood
		--elseif contained_animal_amount == an_gold_contained then
		    --contained_animal_resource = RT_Gold
		--elseif contained_animal_amount == an_stone_contained then
		    --contained_animal_resource = RT_Stone
		--end
		
		
		---- doesnt work
		----Modifier_ApplyToEntity(Modifier_Create(MAT_EntityType, "health_maximum_modifier", MUT_Multiplication, false, rates.mult, Entity_GetBlueprint(entityID)), entityID, 0.0)
		
		
		
		--if not rates.swap_resource then
			--Entity_SetResource(entityID, contained_animal_resource, contained_animal_amount * rates.mult)
		--else
			--local rand_val = RND_RandInt(1, 4)
			--local res = RT_FOOD
			--if rand_val == 1 then res = RT_Food elseif rand_val == 2 then res = RT_Wood elseif rand_val == 3 then res = RT_Gold else res = RT_Stone end
			
			--Entity_SetResource(entityID, contained_animal_resource, 0)
			--Entity_SetResource(entityID, res, contained_animal_amount * rates.mult)
		--end
	--end

 	EGroup_ForEach( EGroup_FromName("RND_forage"), RandomizeRes )
	EGroup_ForEach( EGroup_FromName("RND_deposits"), RandomizeRes )
	EGroup_ForEach( EGroup_FromName("RND_shore"), RandomizeRes )
	EGroup_ForEach( EGroup_FromName("RND_deep"), RandomizeRes )

	RND_MeasureEnd("RND_Start: Gaia(Resource Deposits)")

	RND_Print("RND_Rand was called " .. RND_Rand_Count .. " times")
	RND_Print("RND_Chance was called " .. RND_Chance_Count .. " times")
	RND_Print(RND_Modifier_Create_Count .. " modifiers were created")
	RND_Print(RND_Modifier_Apply_Count .. " modifiers were applied")

end

-- Randomizes upgrades
--MARK: Upgrades
function RND_ApplyUpgradeBonus(bps)
	for _, ubp in pairs(bps) do
		local rates = {
			cost_multiplier = {
				food = RND_Rand(0.1, 2.0) + RND_Rand(1.0, 6.0) * RND_Chance(0.05),
				wood = RND_Rand(0.1, 2.0) + RND_Rand(1.0, 6.0) * RND_Chance(0.05),
				gold = RND_Rand(0.1, 2.0) + RND_Rand(1.0, 6.0) * RND_Chance(0.05),
				stone = RND_Rand(0.1, 2.0) + RND_Rand(1.0, 6.0) * RND_Chance(0.05),
			},
			cost_additive = {
				food = math.floor(10.0 ^ RND_Rand(0.0, 2.6)) * RND_Chance(0.1),
				wood = math.floor(10.0 ^ RND_Rand(0.0, 2.6)) * RND_Chance(0.1),
				gold = math.floor(10.0 ^ RND_Rand(0.0, 2.6)) * RND_Chance(0.1),
				stone = math.floor(10.0 ^ RND_Rand(0.0, 2.6)) * RND_Chance(0.1),
			},
			production_speed_modifier = RND_Rand(RND_Rand(0.0, 0.5), 2.0) + 5 * RND_Chance(0.15)
		}
		
		RND_Modify(ubp, "upgrade_cost_food_modifier", rates.cost_multiplier.food, MUT_Multiplication, MAT_Upgrade)
		RND_Modify(ubp, "upgrade_cost_wood_modifier", rates.cost_multiplier.wood, MUT_Multiplication, MAT_Upgrade)
		RND_Modify(ubp, "upgrade_cost_gold_modifier", rates.cost_multiplier.gold, MUT_Multiplication, MAT_Upgrade)
		RND_Modify(ubp, "upgrade_cost_stone_modifier", rates.cost_multiplier.stone, MUT_Multiplication, MAT_Upgrade)
		
		RND_Modify(ubp, "upgrade_cost_food_modifier", rates.cost_additive.food, MUT_Addition, MAT_Upgrade)
		RND_Modify(ubp, "upgrade_cost_wood_modifier", rates.cost_additive.wood, MUT_Addition, MAT_Upgrade)
		RND_Modify(ubp, "upgrade_cost_gold_modifier", rates.cost_additive.gold, MUT_Addition, MAT_Upgrade)
		RND_Modify(ubp, "upgrade_cost_stone_modifier", rates.cost_additive.stone, MUT_Addition, MAT_Upgrade)
		
		RND_Modify(ubp, "upgrade_production_speed_modifier", rates.production_speed_modifier, MUT_Multiplication, MAT_Upgrade)
	end
end

RND_MODIFIERS = { }

--MARK: Ebps
-- Randomizes ebps
function RND_ApplyBonus(bps)
	for _, ebp in pairs(bps) do 
		if RND_MODIFIERS[ebp.PropertyBagGroupID] == nil then
			RND_MODIFIERS[ebp.PropertyBagGroupID] = true
			
			local worker = Entity_IsEBPOfType(ebp, RND_BP_WORKER)
			local unit = Entity_IsEBPOfType(ebp, RND_BP_UNIT_CLASS)
			local tc = Entity_IsEBPOfType(ebp, RND_BP_TOWN_CENTER)
			
			local econ_building = Entity_IsEBPOfType(ebp, RND_BP_ECON_BUILDING)
			local wall = Entity_IsEBPOfType(ebp, RND_BP_WALL)
			local house = Entity_IsEBPOfType(ebp, RND_BP_HOUSE)
			local wonder_or_landmark = Entity_IsEBPOfType(ebp, RND_BP_WONDERS_AND_LANDMARKS)
			local farm = Entity_IsEBPOfType(ebp, RND_BP_FARM)
		
			local rates = {}

			-- Set up rates
			if tc or wonder_or_landmark then
				rates.production_speed_modifier = 2.0 ^ RND_Rand(-0.2, 0.2)
			else
				rates.production_speed_modifier = 10.0 ^ RND_Rand(-0.7, 1.2) + 5 * RND_Chance(0.1)
			end


			rates.trade_route_resource_generation_modifier = 2.0 ^ RND_Rand(-0.6, 0.6)

			if worker then
				--rates.harvest_rate = {
					--food = 2.0 ^ RND_Rand(-1.0, 1.0),
					--wood = 2.0 ^ RND_Rand(-1.0, 1.0),
					--gold = 2.0 ^ RND_Rand(-1.0, 1.0),
					--stone = 2.0 ^ RND_Rand(-1.0, 1.0),
				--}
				--rates.carry_capacity = {
					--food = 2.0 ^ RND_Rand(-1.0, 1.0),
					--wood = 2.0 ^ RND_Rand(-1.0, 1.0),
					--gold = 2.0 ^ RND_Rand(-1.0, 1.0),
					--stone = 2.0 ^ RND_Rand(-1.0, 1.0),
				--}
				rates.construction_rate = RND_Rand(0.8, 1.4)
				rates.repair_rate_modifier = RND_Rand(0.8, 1.4)
			end
			
			-- truedamage = siege
			rates.armor = {
				melee = 2.0 ^ RND_Rand(-1, 1) + 2.0 ^ RND_Rand(1, 3) * RND_Chance(0.1),
				fire = 2.0 ^ RND_Rand(-1, 1) + 2.0 ^ RND_Rand(1, 3) * RND_Chance(0.1),
				ranged = 2.0 ^ RND_Rand(-1, 1) + 2.0 ^ RND_Rand(1, 3) * RND_Chance(0.1),
				truedamage = 2.0 ^ RND_Rand(-1, 1),
				--anticavalry = 2.0 ^ RND_Rand(-1, 1),
			}
			
			rates.armor_add = {
				melee = RND_Rand(0, 20) * RND_Chance(0.18) + 10.0 ^ RND_Rand(-2, 1.9) * RND_Chance(0.1),
				fire = RND_Rand(0, 30) * RND_Chance(0.18) + 10.0 ^ RND_Rand(-2, 1.9) * RND_Chance(0.1),
				ranged = RND_Rand(0, 10) * RND_Chance(0.18) + 10.0 ^ RND_Rand(-2, 1.9) * RND_Chance(0.1),
				truedamage = RND_Rand(0, 40) * RND_Chance(0.18) + 10.0 ^ RND_Rand(-2, 1.9) * RND_Chance(0.14),
			}

			rates.health_maximum_modifier = 5.0 ^ RND_Rand(-1.0, 1.0)
			rates.sight_radius_modifier = RND_Rand(0.1, 2.0) + RND_Rand(0.0, 2.5) * RND_Chance(0.2)
			
			local costmult = 1.0
			-- tiny bit of balancing
			if not econ_building and not wonder_or_landmark and not worker and not house and not wall then
				-- multiply by 0.8x - 1.2x for health balancing
				costmult = costmult * (1 + math.log(rates.health_maximum_modifier, 10) * 0.2)
				
				-- armor balancing
				if unit then
					costmult = costmult * math.min(1.05, (1 + math.log(rates.armor.melee, 2) * 0.05))
					costmult = costmult * math.min(1.05, 1 + rates.armor_add.melee/600)
				end
				if not unit then
					costmult = costmult * math.min(1.05, (1 + math.log(rates.armor.fire, 2) * 0.05))
					costmult = costmult * math.min(1.05, 1 + rates.armor_add.fire/600)
				end
				costmult = costmult * math.min(1.05, (1 + math.log(rates.armor.ranged, 2) * 0.05))
				costmult = costmult * math.min(1.05, 1 + rates.armor_add.ranged/600)
				
				costmult = costmult * math.min(1.05, (1 + math.log(rates.armor.truedamage, 2) * 0.05))
				costmult = costmult * math.min(1.05, 1 + rates.armor_add.truedamage/600)
				
				-- sight range balancing
				costmult = costmult * math.max(0.95, math.min(1.05, math.sqrt(rates.sight_radius_modifier)))
			end

			
			
			
			
			if econ_building or house or wonder_or_landmark or farm then
				rates.cost_multiplier = {
					food = RND_Rand(0.1, 1.6) + RND_Rand(0.0, 2.0) * RND_Chance(0.03),
					wood = RND_Rand(0.1, 1.6) + RND_Rand(0.0, 2.0) * RND_Chance(0.02),
					gold = RND_Rand(0.1, 1.6) + RND_Rand(0.0, 2.0) * RND_Chance(0.02),
					stone = RND_Rand(0.1, 1.6) + RND_Rand(0.0, 2.0) * RND_Chance(0.015),
					olive_oil = RND_Rand(0.1, 1.5) + RND_Rand(0.0, 1.9) * RND_Chance(0.02),
				}
			else
				rates.cost_multiplier = {
					food = costmult * (RND_Rand(0.1, 2.0) + RND_Rand(1.0, 3.0) * RND_Chance(0.03)),
					wood = costmult * (RND_Rand(0.1, 2.0) + RND_Rand(1.0, 3.0) * RND_Chance(0.02)),
					gold = costmult * (RND_Rand(0.1, 2.0) + RND_Rand(1.0, 3.0) * RND_Chance(0.02)),
					stone = costmult * (RND_Rand(0.1, 2.0) + RND_Rand(1.0, 3.0) * RND_Chance(0.015)),
					olive_oil = costmult * (RND_Rand(0.1, 1.8) + RND_Rand(1.0, 2.5) * RND_Chance(0.02)),
				}
			end
			
			if worker then 
				rates.cost_multiplier.food = RND_Rand(0.8, 1.2)
				rates.production_speed_modifier = rates.cost_multiplier.food
			end
				

			if not worker and not wall then
				if econ_building or house or wonder_or_landmark or farm then
					-- less variance in economic buildings or housing
					rates.cost_additive = {
						food = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.15),
						wood = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.15),
						gold = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.15),
						stone = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.15),
						olive_oil = 0,
					}
				else
					rates.cost_additive = {
						food = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.15) + math.floor(10.0 ^ RND_Rand(0.0, 3.0)) * RND_Chance(0.025),
						wood = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.15) + math.floor(10.0 ^ RND_Rand(0.0, 3.0)) * RND_Chance(0.025),
						gold = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.15) + math.floor(10.0 ^ RND_Rand(0.0, 3.0)) * RND_Chance(0.025),
						stone = math.floor(10.0 ^ RND_Rand(0.0, 2)) * RND_Chance(0.1) + math.floor(10.0 ^ RND_Rand(0.0, 3.0)) * RND_Chance(0.02),
						olive_oil = 0,
					}
				end
			else
				-- dont add cost to villagers or segmented buildings (walls)
				rates.cost_additive = {
					food = 0,
					wood = 0,
					gold = 0,
					stone = 0,
					olive_oil = 0,
				}
			end

			

			if unit then
				if worker then
					rates.speed_maximum_modifier = 1.125 ^ RND_Rand(-2.0, 2.0)
				else
					rates.speed_maximum_modifier = 1.5 ^ RND_Rand(-2.0, 2.0)
				end
				rates.acceleration_modifier = rates.speed_maximum_modifier
			end

			-- Apply modifiers
			RND_Modify(ebp, "production_speed_modifier", rates.production_speed_modifier)
			RND_Modify(ebp, "trade_route_resource_generation_modifier", rates.trade_route_resource_generation_modifier)

			if(worker) then
				RND_Modify(ebp, "construction_rate", rates.construction_rate)
				RND_Modify(ebp, "repair_rate_modifier", rates.repair_rate_modifier)
			end	
			
			RND_Modify(ebp, "resource_entity_cost_food", rates.cost_multiplier.food)
			RND_Modify(ebp, "resource_entity_cost_wood", rates.cost_multiplier.wood)
			RND_Modify(ebp, "resource_entity_cost_gold", rates.cost_multiplier.gold)
			RND_Modify(ebp, "resource_entity_cost_stone", rates.cost_multiplier.stone)
			RND_Modify(ebp, "resource_entity_cost_olive_oil", rates.cost_multiplier.olive_oil)

			if(not worker) then
				RND_Modify(ebp, "resource_entity_cost_food", rates.cost_additive.food, MUT_Addition)
				RND_Modify(ebp, "resource_entity_cost_food", rates.cost_additive.wood, MUT_Addition)
				RND_Modify(ebp, "resource_entity_cost_food", rates.cost_additive.gold, MUT_Addition)
				RND_Modify(ebp, "resource_entity_cost_food", rates.cost_additive.stone, MUT_Addition)
				--"resource_entity_cost_olive_oil"
			end
			RND_Modify(ebp, "armor_scalar_for_melee_damage", rates.armor.melee)
			RND_Modify(ebp, "armor_scalar_for_ranged_damage", rates.armor.ranged)
			RND_Modify(ebp, "armor_scalar_for_fire_damage", rates.armor.fire)
			RND_Modify(ebp, "armor_scalar_for_truedamage_damage", rates.armor.truedamage) -- truedamage = siege
			
			RND_Modify(ebp, "armor_scalar_for_melee_damage", rates.armor_add.melee, MUT_Addition)
			RND_Modify(ebp, "armor_scalar_for_ranged_damage", rates.armor_add.ranged, MUT_Addition)
			RND_Modify(ebp, "armor_scalar_for_fire_damage", rates.armor_add.fire, MUT_Addition)
			RND_Modify(ebp, "armor_scalar_for_truedamage_damage", rates.armor_add.truedamage, MUT_Addition)
			
			--"armor_scalar_for_anticavalry_damage"
			
			RND_Modify(ebp, "health_maximum_modifier", rates.health_maximum_modifier)
			RND_Modify(ebp, "sight_radius_modifier", rates.sight_radius_modifier)
			
			if(unit) then
				RND_Modify(ebp, "speed_maximum_modifier", rates.speed_maximum_modifier)
				RND_Modify(ebp, "acceleration_modifier", rates.acceleration_modifier)
			end
		end
	end
end

-- Pop cap
function RND_PopChange(min, max)
	for _, player in pairs(PLAYERS) do
		Modifier_ApplyToPlayer(Modifier_Create(MAT_Player, "max_personnel_cap_player_modifier", MUT_Addition, false, (max - 200), ""), player.id, 0)

		-- Mongols receive always maximum to maintain their unique bonus.
		if player.raceName == "mongol" then
			Modifier_ApplyToPlayer(Modifier_Create(MAT_Player, "personnel_cap_player_modifier", MUT_Addition, false, max - 200, ""), player.id, 0)	
		else
			Modifier_ApplyToPlayer(Modifier_Create(MAT_Player, "personnel_cap_player_modifier", MUT_Addition, false, min, ""), player.id, 0)
		end
	end
end
RND_MeasureEnd("initial_setup")